# Day6 LOD & Tabe Calculation## 6-0. 기초 개념- LOD: 세부수준 계산식
	1. FIXED
		- 지정 변수로 수준 고정하고 계산
		- ```Tableau
			# 첫 구매시점 (고객당)
			{FIXED [고객명]: MIN([주문 일자]}
		
	   	  ```
	2. EXCLUDE
		- 지정 변수의 수준 제외하고 계산
	3. INCLUDE		- 차원/수준이 행/열에는 포함이 안되어있지만(view 수준), 지정 변수 포함하고 계산

	- FIXED vs INCLUDE
		- fixed는 지정 변수만 고려, include는 연관된 세부 수준까지 고려
		- ex. 각 함수에 주문id를 지정
			- fixed는 진짜 주문id만 고려하기 때문에, 국가별로 중복되는 주문id가 있을 때 겹쳐서 계산
			- include는 국가와 주문id를 고려하기 때문에, 고유 주문id로 계산 가능- 테이블 계산
	- 기존 집계 계산의 결과 집합 위에 추가 계산을 실행
	- `RUNNING_MAX(SUM[수익])`
		- 누계 중 최댓값 (ex. 해당 월 최대가 아닌, 현재까지의 월 중 최대)
		- 기록 수익인가? `SUM([수익]) = [현재 가장 높은 수치]`
		- <img src="./image/00. 기초교육자료.png" width="500" height="300">

- 범위/방향 설정
	- 우클릭 -> 계산 도구
	- 계산 범위(테이블, 패널, 셀)와 방향 설정
		1. 테이블(옆으로)
		2. 패널(옆으로) ...## 6-1. 전일 대비 종가 등락
<img src="./image/01. 전일 대비 종가 등락.png" width="600" height="350">

- 종가를 라인, 원 각각으로 표현하기 위해 이중축 활용 (동기화)
- 테이블 계산식을 만들기 어렵다면 퀵 테이블 계산에서 시작하자!
	- 퀵 테이블 계산을 이용해 '차이' 계산 (계산 기준: 전일) 후, 해당 계산식 활용해서 테이블 계산삭에 활용
	- 양수, 음수, 동일(0,null)로 구분
		- ```Tableau
			IF (SUM([종가])) - LOOKUP(ZN(SUM([종가])), -1) > 0 THEN "▲"
			ELSEIF (SUM([종가])) - LOOKUP(ZN(SUM([종가])), -1) < 0 THEN "▽"
			ELSE "-"
			END
		  ```
## 6-2. 전국 기준 매출 구성비율
<img src="./image/02. 전국기준 매출 구성비율.png" width="600" height="350">

- 퀵 테이블 계산에서 '구성비율' 사용하여 계산

## 6-3. 지역별/전국구 구성비 함께 보기
<img src="./image/03. 지역별&전국구 구성비 함께.png" width="600" height="350">

- 전국구 -> 시군구 수준으로 넘어가면 값이 바뀌게됨 => 수준이 바뀌지 않게 LOD 활용!
	- 전국 기준 매출
		- ```Tableau
			{ FIXED [국가]: SUM(매출)}
		  ```
	- 전국 기준 구성비율
		- ```Tableau
			SUM([매출]) / SUM([전국 기준 매출])
		  ```
- 전국구, 시군구 수준의 구성비율을 같이 볼 수 있게됨!

## 6-4. 과거 구매 고객의 매출 기여도
<img src="./image/04. 과거 구매 고객의 매출 기여도.png" width="600" height="350">

- 고객별 최초 구매일 (LOD)
	- ```Tableau
		{ FIXED [고객번호]: MIN([주문 일자])}
	  ```
         
-> 2015년 첫 구매를 발생시킨 고객이 2018년도까지 여전히 많은 매출에 기여하고 있는 것으로 보임            
-> 반면, 매년 신규 유입되는 고객의 매출 비중이 감소하는 것으로 나타남 -> 원인이 무엇일까?

## 6-5. 고객당 재구매 시점까지 경과 기간 (분기 단위)
<img src="./image/05. 고객당 재구매 시점까지 경과 기간.png" width="600" height="350">

- 고객별 최초 재구매일 (LOD)
	- ```Tableau
		# IIF: 조건, 해당하는 경우, 해당하지 않는 경우
		{ FIXED [고객번호]: 
				MIN(
					IIF([고객별 최초 구매일] < [주문 일자], [주문 일자], NULL)
				)}
	  ```
	
- 고객별 재구매 경과기간 - 분기 기준 (LOD)
	- ```Tableau
		# 분기 기준
		DATEDIFF('quarter', [고객별 최초 구매일], [고객별 최초 재구매일])
	  ```
	- '차원'으로 이동 시킨 후 열 선반에 놓기
               
-> 2015년 2분기에 첫 구매한 고객은 2분기가 지난 후 가장 많이 재구매한 것으로 나타남
